"use strict";(()=>{var e={};e.id=766,e.ids=[766],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},8220:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},9988:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>k,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{DELETE:()=>c,GET:()=>d,PUT:()=>l});var i=t(9303),o=t(8716),n=t(670),s=t(9556),u=t(3430);async function d(e,r){try{if(u.ve)throw new u.dR("Produk tidak ditemukan.");await (0,u.yH)();let{idOrSlug:e}=r.params,t=await s._.product.findFirst({where:{OR:[{id:e},{slug:e}]}});if(!t)throw new u.dR("Produk tidak ditemukan.");return(0,u.A4)(t)}catch(e){return(0,u.S3)(e)}}async function l(e,r){try{if(u.ve)return(0,u.A4)({message:"Product modifications are disabled during build."},{status:503});await (0,u.yH)(),await (0,u.mk)(e);let{idOrSlug:t}=r.params,a=await s._.product.findUnique({where:{id:t}});if(!a)throw new u.dR("Produk tidak ditemukan.");let i=await e.json().catch(()=>({})),o=(0,u.x6)(i);if(o.error||!o.value)throw new u.oY(o.error);let{value:n}=o,d=n.slug?(0,u.lV)(n.slug):n.name!==a.name?(0,u.lV)(n.name):a.slug,l=await (0,u.IF)(d,a.id),c=await s._.product.update({where:{id:a.id},data:{...n,slug:l}});return(0,u.A4)(c)}catch(e){return(0,u.S3)(e)}}async function c(e,r){try{if(u.ve)return(0,u.A4)({message:"Product modifications are disabled during build."},{status:503});await (0,u.yH)(),await (0,u.mk)(e);let{idOrSlug:t}=r.params,a=await s._.product.findUnique({where:{id:t}});if(!a)throw new u.dR("Produk tidak ditemukan.");return await s._.product.delete({where:{id:a.id}}),(0,u.A4)({message:"Produk dihapus."})}catch(e){return(0,u.S3)(e)}}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/products/[idOrSlug]/route",pathname:"/api/products/[idOrSlug]",filename:"route",bundlePath:"app/api/products/[idOrSlug]/route"},resolvedPagePath:"/Users/mbairm12020/Documents/goldenstore/goldenstore/app/api/products/[idOrSlug]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g}=p,f="/api/products/[idOrSlug]/route";function k(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},9556:(e,r,t)=>{t.d(r,{_:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient},3430:(e,r,t)=>{t.d(r,{A4:()=>D,Fw:()=>y,IF:()=>S,S3:()=>I,V3:()=>g,dR:()=>_,lV:()=>v,m1:()=>w,mk:()=>f,oY:()=>E,rt:()=>A,ve:()=>c,x6:()=>b,yH:()=>k,yj:()=>x});var a=t(2023),i=t.n(a),o=t(1482),n=t.n(o),s=t(9556);let u=process.env.JWT_SECRET||"change-me-in-production",d=process.env.JWT_EXPIRES_IN||"2h",l=process.env.ADMIN_DEFAULT_PASSWORD||"",c="undefined"!=typeof process&&"phase-production-build"===process.env.NEXT_PHASE,p={storeName:"Golden Store",logoUrl:"https://pub-cdn.sider.ai/u/U0W8H7R4X2W/web-coder/68d4014e6cd86d3975e3c196/resource/55a4522f-969b-4e9f-b5a4-8f67ffc837e4.jpg",heroHeadline:"Koleksi Aksesoris dengan Desain Sticker yang menarik",heroTagline:"untuk Gaya Sehari-hari",heroDescription:"Temukan aksesoris pilihan dari Golden Store. Desain menarik, kualitas terjamin, dan harga bersahabat, cocok untuk hadiah maupun koleksi pribadi.",heroImage:"https://i.imghippo.com/files/Cwuh6142fk.jpeg",whatsappNumber:"6281234567890",instagram:"https://instagram.com/yourstore",facebook:"https://facebook.com/yourstore",tiktok:"https://tiktok.com/@yourstore",shopee:"https://shopee.co.id/yourstore"},m=[{label:"Home",url:"#home",order:0,isExternal:!1},{label:"Produk",url:"#produk",order:1,isExternal:!1},{label:"Shopee",url:p.shopee,order:2,isExternal:!0}],h=null;function g(e){let r={sub:e.id,username:e.username,role:e.role};return n().sign(r,u,{expiresIn:d})}async function f(e){let[r,t]=(e.headers.get("authorization")||"").split(" ");if("Bearer"!==r||!t)throw new x("Authorization header missing or malformed.");try{return n().verify(t,u)}catch(e){throw console.error("Auth error:",e),new x("Token tidak valid atau sudah kedaluwarsa.")}}async function k(){c||(h||(h=(async()=>{await T(),await N()})()),await h)}async function w(){return await k(),A(await s._.storeSetting.findFirst({include:{navigation:{orderBy:{order:"asc"}}}}))}function y(e){let r;let t=e??{};for(let e of["storeName","heroHeadline","heroTagline","heroDescription","heroImage"]){let r=t[e];if(!r||"string"!=typeof r||0===r.trim().length)return{error:`Field ${e} wajib diisi.`}}let a={storeName:String(t.storeName).trim(),logoUrl:P(t.logoUrl),heroHeadline:String(t.heroHeadline).trim(),heroTagline:String(t.heroTagline).trim(),heroDescription:String(t.heroDescription).trim(),heroImage:String(t.heroImage).trim(),whatsappNumber:P(t.whatsappNumber),instagram:P(t.instagram),facebook:P(t.facebook),tiktok:P(t.tiktok),shopee:P(t.shopee)};if(void 0!==t.navigation){if(!Array.isArray(t.navigation))return{error:"Navigation harus berupa array."};try{r=t.navigation.map((e,r)=>{let t="string"==typeof e?.label?e.label.trim():"",a="string"==typeof e?.url?e.url.trim():"";if(!t||!a)throw Error("Setiap item navigasi wajib memiliki label dan url.");let i="string"==typeof e?.id&&e.id.trim().length>0?e.id.trim():void 0,o=!!e?.isExternal;return{id:i,label:t,url:a,order:r,isExternal:o}})}catch(e){return{error:e instanceof Error?e.message:"Data navigasi tidak valid."}}}return{value:{storeData:a,navigation:r}}}function b(e){let{name:r,price:t,image:a,description:i,shopeeUrl:o,whatsappNumber:n,tags:s,slug:u}=e??{};if(!r||!i||!a||!o)return{error:"Field name, description, image, dan shopeeUrl wajib diisi."};let d=Number(t);return!Number.isFinite(d)||d<0?{error:"Price harus berupa angka positif."}:{value:{name:String(r).trim(),price:Math.round(d),image:String(a).trim(),description:String(i).trim(),shopeeUrl:String(o).trim(),whatsappNumber:n?String(n).trim():null,tags:Array.isArray(s)?s.map(e=>String(e).trim()).filter(Boolean):[],slug:u?String(u).trim():void 0}}}function v(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"").slice(0,64)||`produk-${Date.now()}`}async function S(e,r){let t=e,a=1;for(;;){let i=await s._.product.findUnique({where:{slug:t}});if(!i||i.id===r)return t;t=`${e}-${a}`.slice(0,64),a+=1}}function A(e){if(!e)return{...p,id:null,key:"default",navigation:m.map((e,r)=>({id:`default-${r}`,...e}))};let r=(e.navigation||[]).map(e=>({id:e.id,label:e.label,url:e.url,order:e.order,isExternal:e.isExternal})).sort((e,r)=>e.order-r.order);return{id:e.id,key:e.key,storeName:e.storeName,logoUrl:e.logoUrl,heroHeadline:e.heroHeadline,heroTagline:e.heroTagline,heroDescription:e.heroDescription,heroImage:e.heroImage,whatsappNumber:e.whatsappNumber,instagram:e.instagram,facebook:e.facebook,tiktok:e.tiktok,shopee:e.shopee,createdAt:e.createdAt,updatedAt:e.updatedAt,navigation:r}}class x extends Error{constructor(...e){super(...e),this.status=401}}class E extends Error{constructor(...e){super(...e),this.status=400}}class _ extends Error{constructor(...e){super(...e),this.status=404}}function P(e){if("string"!=typeof e)return null;let r=e.trim();return r.length>0?r:null}async function T(){if(l&&0===await s._.admin.count()){let e=await i().hash(l,10);await s._.admin.create({data:{username:"admin",passwordHash:e}}),console.log("✅ Default admin account created (username: admin)")}}async function N(){let e=await s._.storeSetting.findFirst();return e?(e.key||(e=await s._.storeSetting.update({where:{id:e.id},data:{key:"default"}})),0===await s._.navigationItem.count({where:{storeId:e.id}})&&m.length>0&&await s._.navigationItem.createMany({data:m.map(r=>({...r,storeId:e.id}))})):(e=await s._.storeSetting.create({data:{key:"default",...p,navigation:{create:m.map(e=>({...e}))}}}),console.log("✅ Default store settings created")),e}function D(e,r={}){return Response.json(e,r)}function I(e){return e instanceof x||e instanceof E||e instanceof _?Response.json({message:e.message},{status:e.status}):(console.error("Unhandled API error:",e),Response.json({message:"Terjadi kesalahan pada server."},{status:500}))}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,443],()=>t(9988));module.exports=a})();