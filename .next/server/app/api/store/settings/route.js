"use strict";(()=>{var e={};e.id=231,e.ids=[231],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},5020:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>u,PUT:()=>d});var i=r(9303),o=r(8716),n=r(670),s=r(9556),l=r(3430);async function u(){try{let e=await (0,l.m1)();return(0,l.A4)(e)}catch(e){return(0,l.S3)(e)}}async function d(e){try{await (0,l.yH)(),await (0,l.mk)(e);let t=await e.json().catch(()=>({})),r=(0,l.Fw)(t);if(r.error)throw new l.oY(r.error);let a=await s._.$transaction(async e=>{let t=await e.storeSetting.findFirst();if(t=t?await e.storeSetting.update({where:{id:t.id},data:r.value.storeData}):await e.storeSetting.create({data:{key:"default",...r.value.storeData}}),r.value.navigation){let a=[];for(let i of r.value.navigation){let r={label:i.label,url:i.url,order:i.order,isExternal:i.isExternal};if(i.id)try{let t=await e.navigationItem.update({where:{id:i.id},data:r});a.push(t.id);continue}catch{}let o=await e.navigationItem.create({data:{...r,storeId:t.id}});a.push(o.id)}await e.navigationItem.deleteMany({where:{storeId:t.id,id:{notIn:a}}})}let a=await e.navigationItem.findMany({where:{storeId:t.id},orderBy:{order:"asc"}});return{...t,navigation:a}});return(0,l.A4)((0,l.rt)(a))}catch(e){return(0,l.S3)(e)}}let c=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/store/settings/route",pathname:"/api/store/settings",filename:"route",bundlePath:"app/api/store/settings/route"},resolvedPagePath:"/Users/mbairm12020/Documents/goldenstore/goldenstore/app/api/store/settings/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g}=c,h="/api/store/settings/route";function f(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},9556:(e,t,r)=>{r.d(t,{_:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient},3430:(e,t,r)=>{r.d(t,{A4:()=>T,Fw:()=>k,IF:()=>b,S3:()=>_,V3:()=>g,dR:()=>A,lV:()=>v,m1:()=>w,mk:()=>h,oY:()=>I,rt:()=>S,x6:()=>y,yH:()=>f,yj:()=>x});var a=r(2023),i=r.n(a),o=r(1482),n=r.n(o),s=r(9556);let l=process.env.JWT_SECRET||"change-me-in-production",u=process.env.JWT_EXPIRES_IN||"2h",d=process.env.ADMIN_DEFAULT_PASSWORD||"",c={storeName:"Golden Store",logoUrl:"https://pub-cdn.sider.ai/u/U0W8H7R4X2W/web-coder/68d4014e6cd86d3975e3c196/resource/55a4522f-969b-4e9f-b5a4-8f67ffc837e4.jpg",heroHeadline:"Koleksi Aksesoris dengan Desain Sticker yang menarik",heroTagline:"untuk Gaya Sehari-hari",heroDescription:"Temukan aksesoris pilihan dari Golden Store. Desain menarik, kualitas terjamin, dan harga bersahabat, cocok untuk hadiah maupun koleksi pribadi.",heroImage:"https://i.imghippo.com/files/Cwuh6142fk.jpeg",whatsappNumber:"6281234567890",instagram:"https://instagram.com/yourstore",facebook:"https://facebook.com/yourstore",tiktok:"https://tiktok.com/@yourstore",shopee:"https://shopee.co.id/yourstore"},p=[{label:"Home",url:"#home",order:0,isExternal:!1},{label:"Produk",url:"#produk",order:1,isExternal:!1},{label:"Shopee",url:c.shopee,order:2,isExternal:!0}],m=null;function g(e){let t={sub:e.id,username:e.username,role:e.role};return n().sign(t,l,{expiresIn:u})}async function h(e){let[t,r]=(e.headers.get("authorization")||"").split(" ");if("Bearer"!==t||!r)throw new x("Authorization header missing or malformed.");try{return n().verify(r,l)}catch(e){throw console.error("Auth error:",e),new x("Token tidak valid atau sudah kedaluwarsa.")}}async function f(){m||(m=(async()=>{await D(),await N()})()),await m}async function w(){return await f(),S(await s._.storeSetting.findFirst({include:{navigation:{orderBy:{order:"asc"}}}}))}function k(e){let t;let r=e??{};for(let e of["storeName","heroHeadline","heroTagline","heroDescription","heroImage"]){let t=r[e];if(!t||"string"!=typeof t||0===t.trim().length)return{error:`Field ${e} wajib diisi.`}}let a={storeName:String(r.storeName).trim(),logoUrl:E(r.logoUrl),heroHeadline:String(r.heroHeadline).trim(),heroTagline:String(r.heroTagline).trim(),heroDescription:String(r.heroDescription).trim(),heroImage:String(r.heroImage).trim(),whatsappNumber:E(r.whatsappNumber),instagram:E(r.instagram),facebook:E(r.facebook),tiktok:E(r.tiktok),shopee:E(r.shopee)};if(void 0!==r.navigation){if(!Array.isArray(r.navigation))return{error:"Navigation harus berupa array."};try{t=r.navigation.map((e,t)=>{let r="string"==typeof e?.label?e.label.trim():"",a="string"==typeof e?.url?e.url.trim():"";if(!r||!a)throw Error("Setiap item navigasi wajib memiliki label dan url.");let i="string"==typeof e?.id&&e.id.trim().length>0?e.id.trim():void 0,o=!!e?.isExternal;return{id:i,label:r,url:a,order:t,isExternal:o}})}catch(e){return{error:e instanceof Error?e.message:"Data navigasi tidak valid."}}}return{value:{storeData:a,navigation:t}}}function y(e){let{name:t,price:r,image:a,description:i,shopeeUrl:o,whatsappNumber:n,tags:s,slug:l}=e??{};if(!t||!i||!a||!o)return{error:"Field name, description, image, dan shopeeUrl wajib diisi."};let u=Number(r);return!Number.isFinite(u)||u<0?{error:"Price harus berupa angka positif."}:{value:{name:String(t).trim(),price:Math.round(u),image:String(a).trim(),description:String(i).trim(),shopeeUrl:String(o).trim(),whatsappNumber:n?String(n).trim():null,tags:Array.isArray(s)?s.map(e=>String(e).trim()).filter(Boolean):[],slug:l?String(l).trim():void 0}}}function v(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"").slice(0,64)||`produk-${Date.now()}`}async function b(e,t){let r=e,a=1;for(;;){let i=await s._.product.findUnique({where:{slug:r}});if(!i||i.id===t)return r;r=`${e}-${a}`.slice(0,64),a+=1}}function S(e){if(!e)return{...c,id:null,key:"default",navigation:p.map((e,t)=>({id:`default-${t}`,...e}))};let t=(e.navigation||[]).map(e=>({id:e.id,label:e.label,url:e.url,order:e.order,isExternal:e.isExternal})).sort((e,t)=>e.order-t.order);return{id:e.id,key:e.key,storeName:e.storeName,logoUrl:e.logoUrl,heroHeadline:e.heroHeadline,heroTagline:e.heroTagline,heroDescription:e.heroDescription,heroImage:e.heroImage,whatsappNumber:e.whatsappNumber,instagram:e.instagram,facebook:e.facebook,tiktok:e.tiktok,shopee:e.shopee,createdAt:e.createdAt,updatedAt:e.updatedAt,navigation:t}}class x extends Error{constructor(...e){super(...e),this.status=401}}class I extends Error{constructor(...e){super(...e),this.status=400}}class A extends Error{constructor(...e){super(...e),this.status=404}}function E(e){if("string"!=typeof e)return null;let t=e.trim();return t.length>0?t:null}async function D(){if(d&&0===await s._.admin.count()){let e=await i().hash(d,10);await s._.admin.create({data:{username:"admin",passwordHash:e}}),console.log("✅ Default admin account created (username: admin)")}}async function N(){let e=await s._.storeSetting.findFirst();return e?(e.key||(e=await s._.storeSetting.update({where:{id:e.id},data:{key:"default"}})),0===await s._.navigationItem.count({where:{storeId:e.id}})&&p.length>0&&await s._.navigationItem.createMany({data:p.map(t=>({...t,storeId:e.id}))})):(e=await s._.storeSetting.create({data:{key:"default",...c,navigation:{create:p.map(e=>({...e}))}}}),console.log("✅ Default store settings created")),e}function T(e,t={}){return Response.json(e,t)}function _(e){return e instanceof x||e instanceof I||e instanceof A?Response.json({message:e.message},{status:e.status}):(console.error("Unhandled API error:",e),Response.json({message:"Terjadi kesalahan pada server."},{status:500}))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,443],()=>r(5020));module.exports=a})();